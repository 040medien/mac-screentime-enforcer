# Home Assistant package example for two children
# Replace child_id/device_id/topic_prefix values with your own. Keep the /mac tier so each device type stays isolated.

mqtt:
  sensor:
    - name: "Kiddo Mac Minutes Today"
      unique_id: kiddo_mac_minutes_today
      state_topic: "screen/kiddo/mac/mac-mini/minutes_today"
      unit_of_measurement: "min"
      qos: 1
      icon: mdi:clock-time-ten-outline
  binary_sensor:
    - name: "Kiddo Mac Active"
      unique_id: kiddo_mac_active
      state_topic: "screen/kiddo/mac/mac-mini/active"
      payload_on: "1"
      payload_off: "0"
      device_class: running
      icon: mdi:clock-time-ten-outline

input_number:
  kiddo_mac_daily_budget_minutes:
    name: "Kiddo Mac Daily Budget (min)"
    min: 30
    max: 600
    step: 15
    unit_of_measurement: min
    icon: mdi:timer

input_boolean:
  kiddo_mac_parent_override:
    name: "Kiddo Mac Parent Override"
    icon: mdi:shield-check

automation:
  - alias: "Kiddo Mac Budget Enforcement"
    trigger:
      - platform: numeric_state
        entity_id: sensor.kiddo_mac_minutes_today
        above: input_number.kiddo_mac_daily_budget_minutes
    condition:
      - condition: state
        entity_id: input_boolean.kiddo_mac_parent_override
        state: "off"
    action:
      - service: mqtt.publish
        data:
          topic: "screen/kiddo/allowed"
          qos: 1
          retain: true
          payload: "0"

  - alias: "Kiddo Mac Allow When Under Budget"
    trigger:
      - platform: numeric_state
        entity_id: sensor.kiddo_mac_minutes_today
        below: input_number.kiddo_mac_daily_budget_minutes
    condition:
      - condition: state
        entity_id: input_boolean.kiddo_mac_parent_override
        state: "off"
    action:
      - service: mqtt.publish
        data:
          topic: "screen/kiddo/allowed"
          qos: 1
          retain: true
          payload: "1"

  - alias: "Kiddo Mac Override"
    trigger:
      - platform: state
        entity_id: input_boolean.kiddo_mac_parent_override
    action:
      - service: mqtt.publish
        data:
          topic: "screen/kiddo/allowed"
          qos: 1
          retain: true
          payload: >-
            {{ "1" if is_state('input_boolean.kiddo_mac_parent_override', 'on') else "0" }}
